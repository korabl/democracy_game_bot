import logging, os
from dotenv import load_dotenv
from client import Gpt
# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
load_dotenv()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç OpenAI
client = Gpt(api_key=os.getenv("OPENAI_API_KEY"))

# –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging.basicConfig(format='%(asctime)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞ —á–µ—Ä–µ–∑ GPT
async def generate_world_from_gpt(game_year, max_tokens=800):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞...")  # –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏

        prompt = f"""
        –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –≥–æ–¥: {format_year(game_year)} 

        –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–π –º–∏—Ä –¥–ª—è –¥–ª—è {format_year(game_year)} –≥–æ–¥–∞. –ó–∞–±—É–¥—å –≤—Å–µ, –æ —á–µ–º –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –¥–æ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞.
        –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —ç—Ç–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–µ - –ø–æ–≥—Ä—É–∑–∏ –∏–≥—Ä–æ–∫–∞ –≤ –º–∏—Ä, —Ä–∞—Å—Å–∫–∞–∂–∏ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏ –≤—ã–∑–æ–≤–∞—Ö, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏. 
        –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω –≤ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Å—Ç–∏–ª–µ, –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–µ–º –¢–∞—Ä–∞–Ω—Ç–∏–Ω–æ –∏–ª–∏ –ì–∞—è –†–∏—á–∏, —Å –¥—Ä–∞–º–∞—Ç—É—Ä–≥–∏–µ–π, –Ω–æ –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –∑–∞ —Ä–∞–º–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ñ–∏–∑–∏–∫–∏. 
        –°–æ—Ö—Ä–∞–Ω—è–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫—É—é –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω–æ—Å—Ç—å, –¥–µ–ª–∞—è –º–∏—Ä –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–º –∏ –ø–æ–≥—Ä—É–∂–∞—é—â–∏–º, —Å —è—Ä–∫–∏–º–∏ —Ñ—Ä–∞–∑–∞–º–∏, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –≤—Ä–µ–º–µ–Ω–∏.
        
        –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
        2. –ü—Ä–æ–±–ª–µ–º—ã –∏ –≤—ã–∑–æ–≤—ã: —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ, –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ, –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ ‚Äî —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∂–∏–∑–Ω—å –ª—é–¥–µ–π? –°–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã –º–∏—Ä –±—ã–ª –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–º –∏ –æ—â—É—â–∞–ª—Å—è —Ç—è–∂—ë–ª—ã–º.
        3. –ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è: –ø—Ä–∏–¥—É–º–∞–π —Å—Ç—Ä–∞–Ω—É, –≥–æ—Ä–æ–¥, –≤–∞–∂–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏, –∫–∞–∫ —Ä–µ–∫–∏, –≥–æ—Ä—ã –∏–ª–∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–≥–∏–æ–Ω—ã, –Ω–æ –∏–∑–±–µ–≥–∞–π —Å–≤–µ—Ä—Ö—ä–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ.
        4. –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –∏ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã: –º–∏—Ñ—ã, —Ä–µ–ª–∏–≥–∏–∏, –∏—Å–∫—É—Å—Å—Ç–≤–æ, –ø–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –∫–∞–∫ –ª—é–¥–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –º–∏—Ä?
        5. –í–ª–∏—è–Ω–∏–µ —ç–ø–æ—Ö–∏ –Ω–∞ –ª—é–¥–µ–π: –∫–∞–∫ —ç—Ç–æ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω—è–µ—Ç –∂–∏–∑–Ω—å –ø—Ä–æ—Å—Ç—ã—Ö –ª—é–¥–µ–π? –°–¥–µ–ª–∞–π –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –±–æ—Ä—å–±—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.
        6. –î—Ä–∞–º–∞—Ç—É—Ä–≥–∏—è –∏ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç—å: —Å–æ–∑–¥–∞–π –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è, –¥—Ä–∞–º—ã, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, —á—Ç–æ–±—ã –º–∏—Ä –±—ã–ª –∂–∏–≤—ã–º –∏ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–º.
        
        –°–æ–±–µ—Ä–∏ –≤ –Ω–µ–±–æ–ª—å—à–æ–π –∏ –¥–∏–Ω–∞–º–∏—á–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–±–∑–∞—Ü–µ–≤. –ù–µ —É—Ö–æ–¥–∏ –≤ –∏–∑–ª–∏—à–Ω–∏–µ –¥–µ—Ç–∞–ª–∏, –Ω–æ —Å–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã –º–∏—Ä –∫–∞–∑–∞–ª—Å—è —Ä–µ–∞–ª—å–Ω—ã–º, –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–º –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –¥—Ä–∞–º–∞-—ç–Ω–µ—Ä–≥–∏–µ–π.
        """
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        world_data = await client.prompt(prompt, max_tokens)

        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞ –ø–æ–ª—É—á–µ–Ω.")
        
        return world_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ OpenAI –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞."
    

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –º–∏—Ä–∞ —á–µ—Ä–µ–∑ GPT
async def generate_world_metrics(world_data, max_tokens=1500):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–∏—Ä–∞...")

        json_template = """{
            "economy_metric": N,
            "social_stability_metric": N,
            "ecology_metric": N,
            "security_metric": N,
            "political_support_metric": N
        }"""

        prompt = f"""
        –ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –º–∏—Ä–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –º–∏—Ä–∞.

        –û–ø–∏—Å–∞–Ω–∏–µ –º–∏—Ä–∞:
        {world_data}

        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

        –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
        1. –≠–∫–æ–Ω–æ–º–∏–∫–∞ [economy_metric] (–≥–¥–µ):
        +10: –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ä—Ö–¥–µ—Ä–∂–∞–≤–∞, –≠–∫–æ–Ω–æ–º–∏–∫–∞ –ø—Ä–æ—Ü–≤–µ—Ç–∞–µ—Ç, –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ –Ω–∞ –≤—ã—Å–æ—Ç–µ, –±–æ–≥–∞—Ç—Å—Ç–≤–æ –≤ —Ä—É–∫–∞—Ö –≤—Å–µ—Ö —Å–ª–æ—ë–≤ –Ω–∞—Å–µ–ª–µ–Ω–∏—è, —Å—Ç—Ä–∞–Ω—ã –∑–∞–≤–∏–¥—É—é—Ç.
        -10: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å ‚Äî —Å—Ç—Ä–∞–Ω–∞ –æ–±–∞–Ω–∫—Ä–æ—Ç–∏–ª–∞—Å—å, –¥–µ—Ñ–æ–ª—Ç, –ø–æ–ª–Ω–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏–∫–∏.

        2. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å [social_stability_metric] (–≥–¥–µ):
        +10: –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –µ–¥–∏–Ω—Å—Ç–≤–æ, –ø–æ–ª–Ω–æ–µ –µ–¥–∏–Ω—Å—Ç–≤–æ –≤ –æ–±—â–µ—Å—Ç–≤–µ, –Ω–µ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç–∏, –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–µ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
        -10: –ü–æ–ª–Ω—ã–π –∫–æ–ª–ª–∞–ø—Å, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –≤–æ–π–Ω–∞, –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–ª–∞—Å—Ç—å –ø–æ—Ç–µ—Ä—è–Ω–∞, –≥—Ä–∞–∂–¥–∞–Ω–µ –Ω–∞—á–∏–Ω–∞—é—Ç –±–æ—Ä–æ—Ç—å—Å—è –∑–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ.

        3. –≠–∫–æ–ª–æ–≥–∏—è [ecology_metric] (–≥–¥–µ):
        +10: –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–π, —á–∏—Å—Ç—ã–µ –≤–æ–¥—ã, –≤–æ–∑–¥—É—Ö, —É—Å—Ç–æ–π—á–∏–≤—ã–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã, –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏.
        -10: –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å ‚Äî —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ, –º–∞—Å—Å–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ª—é–¥–µ–π, –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥—ã, –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞.

        4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å [security_metric] (–≥–¥–µ):
        +10: –ü–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –Ω–µ—Ç –ø—Ä–µ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —É–≥—Ä–æ–∑ –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä –∏ –ø–æ—Ä—è–¥–æ–∫.
        -10: –ü–æ–ª–Ω—ã–π –∫–æ–ª–ª–∞–ø—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî –≤–æ–π–Ω–∞, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –≤–æ–π–Ω–∞, —Ç–µ—Ä—Ä–æ—Ä–∏–∑–º –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö, —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ –æ–±—â–µ—Å—Ç–≤–∞, –ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è.

        5. –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ [political_support_metric] (–≥–¥–µ):
        +10: –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –≤–ª–∞—Å—Ç–∏, –≤–ª–∞—Å—Ç—å –ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–æ–±—â–∏–º —É–≤–∞–∂–µ–Ω–∏–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ—Ä—Ä—É–ø—Ü–∏–∏.
        -10: –î–∏–∫—Ç–∞—Ç—É—Ä–∞ / –†–µ–≤–æ–ª—é—Ü–∏—è ‚Äî –ø–æ–ª–Ω—ã–π –∫—Ä–∞—Ö –¥–µ–º–æ–∫—Ä–∞—Ç–∏–∏, –¥–∏–∫—Ç–∞—Ç–æ—Ä—Å–∫–∞—è –≤–ª–∞—Å—Ç—å, —Ä–∞—Å–ø–∞–¥ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞, –Ω–∞—Ä–æ–¥ –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç –≤–ª–∞—Å—Ç–∏.

        üìå –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
        –¢–≤–æ–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ JSON. –ë–µ–∑ –∫–æ–¥–∞, –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π.
        –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π ```python –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–¥–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤.  

        üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON: {json_template}

        üìå –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π (N)
        - –î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç -10 –¥–æ +10
        - –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ (integer)
        - –ó–∞–ø—Ä–µ—â–µ–Ω–æ: —Å—Ç—Ä–æ–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∫–æ–¥–æ–≤—ã–µ –±–ª–æ–∫–∏, —Å–∫–æ–±–∫–∏ `()`.

        –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ JSON, –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞.

        """

        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        metrics_data = await client.prompt(prompt, max_tokens)

        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –ø–æ–ª—É—á–µ–Ω.")
        
        return metrics_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫."
    
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –º–∏—Ä–∞ —á–µ—Ä–µ–∑ GPT
async def generate_world_resources(world_metrics, world_data, max_tokens=600):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–∏—Ä–∞...")

        json_template = """{
            "–î–µ–Ω—å–≥–∏ (–º–æ–Ω–µ—Ç)": N,
            "–ù–∞—Å–µ–ª–µ–Ω–∏–µ (–ª—é–¥–µ–π)": N
        }"""

        prompt = f"""
        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –º–∏—Ä–∞: {world_data}, –∞ –∏–º–µ–Ω–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–Ω–µ–≥ –∏ –Ω–∞—Å–µ–ª–µ–Ω–∏—è.
        –¶–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–Ω–µ–≥: 1 –µ–¥–∏–Ω–∏—Ü–∞ –º–æ–Ω–µ—Ç—ã —Ä–∞–≤–Ω–∞ –æ–¥–Ω–æ–º—É –æ–±—ã—á–Ω–æ–º—É –æ–±–µ–¥—É. 
        –ú–µ—Ç—Ä–∏–∫–∏ –º–∏—Ä–∞: {world_metrics}.

        üìå –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
        –¢–≤–æ–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ JSON. –ë–µ–∑ –∫–æ–¥–∞, –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π.
        –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π ```python, ```json  –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–¥–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤.  

        üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON: {json_template}

        üìå –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π (N)
        - –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ (integer), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–æ–ª–æ—Ç–∞ –∏ –Ω–∞—Å–µ–ª–µ–Ω–∏—è
        - –ó–∞–ø—Ä–µ—â–µ–Ω–æ: —Å—Ç—Ä–æ–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∫–æ–¥–æ–≤—ã–µ –±–ª–æ–∫–∏, —Å–∫–æ–±–∫–∏ `()`.

        –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ JSON, –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞.
        """

        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        character_data = await client.prompt(prompt, max_tokens)

        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–∏—Ä–∞ –ø–æ–ª—É—á–µ–Ω.")
        
        return character_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–∏—Ä–∞: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–∏—Ä–∞."
    
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–ø–¥–µ–π—Ç–∞ –º–µ—Ç—Ä–∏–∫ –º–∏—Ä–∞ —á–µ—Ä–µ–∑ GPT
async def update_world_metrics(world_data, initiation_details, max_tokens=1500):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–∏—Ä–∞...")

        json_template = """{
            "economy_metric": N,
            "social_stability_metric": N,
            "ecology_metric": N,
            "security_metric": N,
            "political_support_metric": N
        }"""

        prompt = f"""
        –ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –º–∏—Ä–∞ –∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –∏–≥—Ä–æ–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã.
        –ù–µ —É–∫–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞, —Ç–æ–ª—å–∫–æ –≤–ª–∏—è–Ω–∏–µ!

        –û–ø–∏—Å–∞–Ω–∏–µ –º–∏—Ä–∞:
        {world_data}

        –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
        {initiation_details}

        üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON: {json_template}

        üìå –ü—Ä–∞–≤–∏–ª–∞:
        - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –≤–ª–∏—è–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ, —Å—Ç–∞–≤—å `"+"`
        - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –≤–ª–∏—è–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç–∞–≤—å `"-"`
        - –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, —Å—Ç–∞–≤—å `"0"`
        - –ù–µ —É–∫–∞–∑—ã–≤–∞–π —á–∏—Å–ª–∞! –¢–æ–ª—å–∫–æ `"+", "-", "0"`

        –û—Ç–≤–µ—Ç—å —Ç–æ–ª—å–∫–æ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π, –Ω–∞—á–∏–Ω–∞—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—è —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏.

        """

        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        metrics_data = await client.prompt(prompt, max_tokens)

        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –ø–æ–ª—É—á–µ–Ω.")
        
        return metrics_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫."

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —á–µ—Ä–µ–∑ GPT
async def generate_character(world_data, character_details, max_tokens=600):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞...")

        prompt = f"""
        –ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –º–∏—Ä–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –∏–≥—Ä—ã –¥–æ 400 —Å–∏–º–≤–æ–ª–æ–≤.

        –û–ø–∏—Å–∞–Ω–∏–µ –º–∏—Ä–∞:
        {world_data}

        –î–µ—Ç–∞–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:
        {character_details}

        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π –¥–µ—Ç–∞–ª–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –≤–∫–ª—é—á–∞—è –µ–≥–æ –ª–∏—á–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞, –º–æ—Ç–∏–≤–∞—Ü–∏—é –∏ –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –≤ –∫—Ä–∞—Ç–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Ç–µ–∫—Å—Ç–∞.
        """

        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        character_data = await client.prompt(prompt, max_tokens)

        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–ª—É—á–µ–Ω.")
        
        return character_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞."
    
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ GPT
async def generate_world_news(game_year, world_data, world_metrics, max_tokens=6800):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π...")

        prompt = f"""
        –ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –º–∏—Ä–∞ –∏ –º–µ—Ç—Ä–∏–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –¥–∞–π–¥–∂–µ—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π —ç—Ç–æ–≥–æ –º–∏—Ä–∞ –¥–æ 800 —Å–∏–º–≤–æ–ª–æ–≤.

        –û–ø–∏—Å–∞–Ω–∏–µ –º–∏—Ä–∞:
        {world_data}

        –ú–µ—Ç—Ä–∏–∫–∏ –º–∏—Ä–∞:
        {world_metrics}

        –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –≥–æ–¥: 
        {format_year(game_year)}

        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π –¥–∞–π–¥–∂–µ—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏—Ä–∞ —ç—Ç–æ–≥–æ –≥–æ–¥–∞, –≤–∫–ª—é—á–∞—è –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –Ω–µ–º.
        –°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –æ—Ç—Ä–æ–∂–∞—Ç—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ —ç–ø–æ—Ö—É, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç (–≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –≥–æ–¥) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫—É —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
        –ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã - –ø–µ—Ä–≤—ã–µ —Ä–∞–∑–≤–æ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω–æ–π –≥–∞–∑–µ—Ç—ã –¥–ª—è –∂–∏—Ç–µ–ª–µ–π. –¢–≤–æ–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–µ—Å—Ç—Ä—è—Ç –∏ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –≤–Ω–∏–º–∞–Ω–∏–µ. –¢—ã –∏–∑–±–µ–≥–∞–µ—à—å —Å–∫—É—á–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ 
        –∏ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ -- —É–≤–ª–µ—á—å —á–∏—Ç–∞—Ç–µ–ª—è –∏ –ø–æ–≥—Ä—É–∑–∏—Ç—å –≤ –∫—Ä—É–≥–æ–≤–æ—Ä–æ—Ç —Å–æ–±—ã—Ç–∏–π -- —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –≤—á–µ—Ä–∞, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–≥–æ–¥–Ω—è –∏ —á—Ç–æ –∂–¥–µ—Ç –Ω–∞—Å –∑–∞–≤—Ç—Ä–∞.
        –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ **–∂–∏—Ä–Ω—ã–π** –∏–ª–∏ _–∫—É—Ä—Å–∏–≤_, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞–ø—Å–ª–æ–∫ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ 
        –∏ –∫—Ä–∞—Ç–∫–∏—Ö –≤—ã–¥–µ–ª–µ–Ω–∏–π.
        
        """

        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        character_data = await client.prompt(prompt, max_tokens)

        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ–ª—É—á–µ–Ω.")
        
        return character_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π."
    
    
# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∏—Ä–∞ —á–µ—Ä–µ–∑ GPT –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤
async def generate_world_changes(budget, money_multiplier, character_description, game_year, world_data, user_initiation, max_tokens=1200):
    try:
        logger.info("–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–∏—Ä–∞...")  # –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏

        prompt = f"""
        –¢—ã - —Å–∏–º—É–ª—è—Ç–æ—Ä –º–∏—Ä–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ—Ü–µ–Ω–∏—Ç—å –∏ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É—á–∏—Ç—ã–≤–∞—è –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–∏—Ä–∞.

        ### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
        - –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_initiation}
        - –û–ø–∏—Å–∞–Ω–∏–µ –º–∏—Ä–∞: {world_data}
        - –û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–≥—Ä–æ–∫–∞: {character_description}
        - –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –≥–æ–¥: {game_year}
        - –î–æ—Å—Ç—É–ø–Ω—ã–π –±—é–¥–∂–µ—Ç (–º–æ–Ω–µ—Ç): {budget} (1 –µ–¥–∏–Ω–∏—Ü–∞ = 1 –æ–±–µ–¥)
        - –¢–µ–∫—É—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–æ—Å—Ç–∞ –¥–µ–Ω–µ–≥: {money_multiplier}

        ### –¢–≤–æ—è –∑–∞–¥–∞—á–∞:
        1. –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Ä–æ—Å—Ç–∞:  
           - –û—Ü–µ–Ω–∏, —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –µ—ë —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
           - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∏ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–∏—Ö –∑–∞—Ç—Ä–∞—Ç ‚Äî –º–æ–∂–Ω–æ –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –±—é–¥–∂–µ—Ç–∞, –Ω–æ –≤ –ù–û–õ–¨ –ù–ò–ö–û–ì–î–ê –ù–ï –£–•–û–î–ò–®–¨.
           - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è ‚Äî –æ—Å—Ç–∞–≤—å —á–∞—Å—Ç—å –±—é–¥–∂–µ—Ç–∞ –Ω–∞ –±—É–¥—É—â–µ–µ.
           - –¢—ã –ù–ï –ú–û–ñ–ï–®–¨ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–º –±—é–¥–∂–µ—Ç–µ.
           - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Å—Ä–µ–¥—Å—Ç–≤, —á–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ, —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑—É–π –µ—ë –≤ —Ä–∞–º–∫–∞—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–Ω–µ–≥.
           - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ ‚Äî –æ—Ç–∫–ª–æ–Ω–∏ –µ—ë —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º.
           
           ### –®–ê–ì 1: –û—Ü–µ–Ω–∫–∞ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç 'estimated_cost'
            - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–µ—Ñ–æ—Ä–º—ã, –≤–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏) ‚Üí –æ—Ü–µ–Ω–∏ 'estimated_cost'.
            - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –º–µ–Ω—è–µ—Ç –∑–∞–∫–æ–Ω—ã, –Ω–∞–ª–æ–≥–∏, —Ü–µ–Ω—ã, –Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä—è–º—ã—Ö –∑–∞—Ç—Ä–∞—Ç** ‚Üí `estimated_cost = 0`.
            - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∏ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–∏—Ö –∑–∞—Ç—Ä–∞—Ç ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Å—å –±—é–¥–∂–µ—Ç.
            - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è ‚Äî –æ—Å—Ç–∞–≤—å —á–∞—Å—Ç—å –±—é–¥–∂–µ—Ç–∞ –Ω–∞ –±—É–¥—É—â–µ–µ.
            - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ ‚Äî –æ—Ç–∫–ª–æ–Ω–∏ –µ—ë —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º.
            
            ### –®–ê–ì 2: –û—Ü–µ–Ω–∫–∞ `money_multiplier` (—Ç–µ–º–ø —Ä–æ—Å—Ç–∞ –¥–µ–Ω–µ–≥)
            –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–æ—Å—Ç –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã –≤ –∫–∞–∑–Ω–µ.  
            –¢–µ–∫—É—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–æ—Å—Ç–∞ –¥–µ–Ω–µ–∂–Ω–æ–π –º–∞—Å—Å—ã –≤ –∫–∞–∑–Ω–µ: `{money_multiplier}`.  
            ‚û° –í–µ—Ä–Ω–∏ —á–∏—Å–ª–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `float`, –Ω–∞–ø—Ä–∏–º–µ—Ä, `-0.2` –≤–º–µ—Å—Ç–æ `-20%`.
            üìå –í–∞–∂–Ω–æ! `money_multiplier` ‚Äî —ç—Ç–æ –ù–ï —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç, –ù–ï –í–í–ü, –ù–ï —É—Ä–æ–≤–µ–Ω—å –∂–∏–∑–Ω–∏.
            ‚ùå –ù–µ –æ—Ü–µ–Ω–∏–≤–∞–π –µ–≥–æ –∫–∞–∫ —Ä–æ—Å—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∏!  
            ‚úÖ –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º—É–ª–µ —Ä–æ—Å—Ç–∞ –±—é–¥–∂–µ—Ç–∞, –∏ –≤–ª–∏—è–µ—Ç –¢–û–õ–¨–ö–û –Ω–∞ –¥–µ–Ω—å–≥–∏.
            ‚ùå –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–π —Å—Ç—Ä–æ–∫—É `"20%"` –∏–ª–∏ `"-20%"`.
            ‚úÖ –í–û–ó–í–†–ê–©–ê–ô `float`, –Ω–∞–ø—Ä–∏–º–µ—Ä, `-0.2` (–¥–ª—è -20%) –∏–ª–∏ `0.1` (–¥–ª—è +10%).
            
            ---
            
            ### –ü—Ä–∞–≤–∏–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π `money_multiplier`:
            1. –ú–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—Ñ–æ—Ä–º—ã, –Ω–∞–ª–æ–≥–∏, –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)  
               - `+0.1` ‚Üí `-0.1`  
            2. –°—Ä–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Ç–æ—Ä–≥–æ–≤—ã–µ —Ä–µ—Ñ–æ—Ä–º—ã, –∫—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã)  
               - `+0.2` ‚Üí `-0.2`  
            3. –ö—Ä—É–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å–∏–ª—å–Ω—ã–µ —Ä–µ—Ñ–æ—Ä–º—ã, –º–∞—Å—à—Ç–∞–±–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)  
               - `+0.3` ‚Üí `-0.3`  
            4. –†–µ–¥–∫–∏–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ (–≤–æ–π–Ω–∞, —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∫–æ–ª–ª–∞–ø—Å, –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ä—ã–≤)  
               - `+0.5` ‚Üí `-0.5`  
            
            ### –ñ—ë—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
            ‚úÖ –ù–µ –¥–æ–ø—É—Å–∫–∞–π –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–æ–ª—å—à–µ `¬±0.5` –∑–∞ 1 –≥–æ–¥
            ‚úÖ `money_multiplier` –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å `0` –∏–ª–∏ —É–π—Ç–∏ –≤ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            ‚úÖ –ï—Å–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `money_multiplier` = `-0.7` 

        2. –°–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–∏—Ä–µ:  
           - –ö–∞–∫ –∏–∑–º–µ–Ω—è—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã –∂–∏–∑–Ω–∏ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã?  
           - –£—á–∏—Ç—ã–≤–∞–π –∑–∞–∫–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤, –∑–∞–∫–æ–Ω —Å–ø—Ä–æ—Å–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∑–∞–∫–æ–Ω —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º, —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω–µ—Ä—Ü–∏—é –∏ –¥—Ä—É–≥–∏–µ –∑–∞–∫–æ–Ω—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –º–∏—Ä–∞.
           - –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—É —Ä–∞–∑–≤–∏—Ç–∏—è –º–∏—Ä–∞, –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å –ø—Ä–æ—à–ª—ã–º —Å–æ–±—ã—Ç–∏—è–º.
           - –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ —Å–ª–∏—à–∫–æ–º –≥–ª–æ–±–∞–ª—å–Ω–∞ –¥–ª—è 1 –≥–æ–¥–∞ ‚Äî –≤–Ω–µ–¥—Ä–∏ —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é —á–∞—Å—Ç—å.

        3. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:  
           ```json
           {{
               "financial_evaluation": {{
                   "estimated_cost": float,  # –°–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
                   "money_multiplier_change": float  # –ö–∞–∫–∞—è –±—É–¥–µ—Ç –¥–µ–ª—å—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ—Å—Ç–∞ –¥–µ–Ω–µ–≥ –≤ –∫–∞–∑–Ω–µ
               }},
               "world_changes": {{
                   "facts": str,  # –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–∏—Ä–∞ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã (—Å—É—Ö–∏–µ —Ñ–∞–∫—Ç—ã)
                   "npc_perspective": str  # –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç –ª–∏—Ü–∞ NPC (—Å —ç–º–æ—Ü–∏—è–º–∏, –ª–∏—á–Ω—ã–º–∏ –∏—Å—Ç–æ—Ä–∏—è–º–∏), –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–≥—Ä–æ–∫—É
               }}
           }}

        """
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ GPT
        world_data = await client.prompt(prompt, max_tokens)
        
        logger.info("–û—Ç–≤–µ—Ç –æ—Ç OpenAI –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –º–∏—Ä–∞ –ø–æ–ª—É—á–µ–Ω.")
        
        return world_data
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ OpenAI –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –º–∏—Ä–∞: {e}")
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –º–∏—Ä–∞."


def format_year(game_year):
    if game_year < 0:
        return f"{abs(game_year)} –≥–æ–¥ –¥–æ –Ω.—ç."

    return f"{game_year} –≥–æ–¥ –Ω.—ç."